@model IEnumerable<Claim>
@{
    ViewData["Title"] = "Pending Claims for Approval";
    var culture = new System.Globalization.CultureInfo("en-ZA");
}

<h2>Pending Claims for Approval</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <p class="mb-0 text-muted">Review and approve/reject claims submitted by lecturers.</p>
    <div>
        <a href="@Url.Action("All")" class="btn btn-outline-info btn-sm">View All Claims</a>
        <a href="@Url.Action("Index", "Home")" class="btn btn-outline-secondary btn-sm">Back to Home</a>
    </div>
</div>

@if (!Model.Any())
{
    <div class="alert alert-info text-center">
        <h4>No Pending Claims</h4>
        <p class="mb-0">There are no claims waiting for approval at this time.</p>
    </div>
}
else
{
    <div class="row">
        @foreach (var claim in Model)
        {
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 border-warning">
                    <div class="card-header bg-warning text-dark">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h5 class="card-title mb-1">Claim #@claim.Id</h5>
                                <small class="text-dark">Submitted: @claim.SubmissionDate.ToString("dd/MM/yyyy")</small>
                            </div>
                            <span class="badge bg-dark">Pending</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h6 class="text-primary">@claim.Lecturer?.Name</h6>
                            <small class="text-muted">@claim.Lecturer?.Email</small>
                        </div>

                        <div class="row mb-3">
                            <div class="col-6">
                                <strong>Hours:</strong><br>
                                <span class="h6">@claim.HoursWorked}</span>
                            </div>
                            <div class="col-6">
                                <strong>Rate:</strong><br>
                                <span class="h6">@claim.HourlyRate.ToString("C", culture)</span>
                            </div>
                        </div>

                        <div class="mb-3 p-2 bg-light rounded">
                            <strong>Total Amount:</strong>
                            <div class="h5 text-success mb-0">@claim.TotalAmount.ToString("C", culture)</div>
                        </div>

                        @if (!string.IsNullOrEmpty(claim.Notes))
                        {
                            <div class="mb-3">
                                <strong>Notes:</strong>
                                <p class="mb-1 small text-muted">@claim.Notes</p>
                            </div>
                        }

                        @if (claim.SupportingDocuments.Any())
                        {
                            <div class="mb-3">
                                <strong>Supporting Documents:</strong>
                                <div class="mt-1">
                                    @foreach (var doc in claim.SupportingDocuments)
                                    {
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <small class="text-truncate" style="max-width: 70%;">
                                                <i class="fas fa-file"></i> @doc.FileName
                                            </small>
                                            <a href="@Url.Content("~/uploads/" + doc.StoredFileName)"
                                               target="_blank"
                                               class="btn btn-sm btn-outline-primary">
                                                View
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="mb-3">
                                <small class="text-muted"><i>No supporting documents</i></small>
                            </div>
                        }

                        <div class="d-grid gap-2">
                            <form asp-action="Approve" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@claim.Id" />
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="fas fa-check"></i> Approve Claim
                                </button>
                            </form>

                            <form asp-action="Reject" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@claim.Id" />
                                <button type="submit" class="btn btn-danger w-100">
                                    <i class="fas fa-times"></i> Reject Claim
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="mt-4 text-center">
        <p class="text-muted">Showing @Model.Count() pending claims</p>
    </div>
}